/* Copyright(C) 2023 Harry Clark * /

/* SEGA Mega Drive Emulator */

/* THIS FILE PERTAINS TO THE MAIN FUNCTIONALITY OF THE VIDEO DISPLAY PORT OF THE MEGA DRIVE */
/* TAKING INTO ACCOUNT THE INTRICACIES OF THE SYSTEM THROUGH VARIOUS PIECES OF DOCUMENTATION */

/* DOCUMENTATION INCLUDES: */

/* https://wiki.megadrive.org/index.php?title=VDP */

#ifndef VISUAL_DISPLAY_PORT
#define VISUAL_DISPLAY_PORT

/* NESTED INCLUDES */

#include "common.h"

/* SYSTEM INCLUDES */

#include <stdbool.h>
#include <stdio.h>

#ifdef DEBUG
#define DEBUG_LOG(...)(__VA_ARGS__)
#else
#define DEBUG_LOG()
#endif

/* THIS INFORMATION IS WITHIN ACCORDANCE TO THE BITWISE VALUE */
/* OF WHAT THE PAL MEGA DRIVE CAN OUTPUT */

#ifndef VDP_TYPES
#define VDP_TYPES

#define HORIZONTAL_IRQ 4 
#define VERTICAL_IRQ 6

#define BUFFER_WIDTH 320
#define BUFFER_HEIGHT 240
#define BUFFER_SIZE (BUFFER_WIDTH * BUFFER_HEIGHT * 3)

#define VDP_CYCLES_PER_CLOCK(VALUE)
static VDP_CYCLES_PER_CLOCK(4); const

#define DISPLAY_VALUES

static U8 VDP_DISPLAY_HEIGHT[] = {28, 30};
static U8 VDP_DISPLAY_WIDTH[] = { 32, 40 };
static U8 VDP_PLANE_SIZE[] = { 32, 64, 0, 128 };

#endif

/* USING THE RULE OF THE NTH VALUE + 4 */
/* THIS HELPS TO CREATE THE CORRESPONDING COLOURS CHANNELS */
/* TO CREATE AN 11 BIT COLOUR VALUE */

/* DOCUMENTATION PERTAINING TO THIS */
/* https://wiki.megadrive.org/index.php?title=VDP_Palette */

#ifndef COLOUR_CHANNELS
#define COLOUR_CHANNELS

#define RED_CHANNEL(COLOUR) FRAGMENT((COLOUR), 3, 1)
#define GREEN_CHANNEL(COLOUR) FRAGMENT((COLOUR), 7, 5)
#define BLUE_CHANNEL(COLOUR) FRAGMENT((COLOUR), 11, 9)

#define COLOUR_COMP(COLOUR) 
static COLOUR_COMP(COLOUR * 32);

#endif

#ifndef REG
#define REG

typedef U8* REG_1;
typedef U32* REG_2;
typedef U32* REG_3;
typedef U32* REG_4;
typedef U32* REG_5;
typedef U8* REG_7;
typedef U8* REG_0C;

/* CREATE THE MAIN STRUCTURE FOR THE VDP */
/* ACCESSING THE METHODS FROM THE CONSOLE, AS WELL AS THE FUNCTIONALITY */
/* FOR THE VDP'S READ AND WRITE CAPATIBILITIES */

/* DOCUMENTATION PERTAINING TO THIS */
/* https://megacatstudios.com/blogs/retro-development/sega-genesis-mega-drive-vdp-graphics-guide-v1-2a-03-14-17 */

typedef struct VDP
{
	typedef MD* MEGA_DRIVE;
	typedef U32* VDP_CLOCK;
	typedef S32* REMAINING_CYCLES;

	typedef U8* VIDEO_MEMORY[0x100000];
	typedef U16* VIDEO_SCROLL_MEMORY;
	COLOUR_COMP(0x40); // USES THE STATIC OBJECT DECLARED (see line 69)
	                   // 0x40 REPRESENTS THE VALUE TO EQUATE TO 4 PALETTE LINES CONSISTING OF 16 COLOR ENTRIES
};

typedef struct VDP_REGISTERS
{
	typedef REG_1* DISPLAY_ENABLED(bool);
	typedef REG_1* INTERRUPT_ENABLED(bool);
	typedef REG_1* DMA(bool);
	typedef REG_1* DISPLAY_HEIGHT;
	typedef REG_2* PLANE_A_LOOKUP;
	typedef REG_3* WINDOW_LOOKUP;
	typedef REG_4* PLANE_B_LOOKUP;
	typedef REG_5* SPRITE_LOOKUP;
	typedef REG_7* BG_COLOUR_PALETTE;
	typedef REG_7* BG_COLOUR_ENTRY;
	typedef REG_0C* DISPLAY_WIDTH;
};

#endif

VOID_FUNCTION(VDP_INIT);
VOID_FUNCTION(VDP_FREE);
VOID_FUNCTION(VDP_RUN_CYCLES);
VOID_FUNCTION(VDP_WRITE_DATA);
VOID_FUNCTION(VDP_WRITE_CONTROL);
VOID_FUNCTION(VDP_GET_RESOLUTION);
VOID_FUNCTION(VDP_GET_PLANE_CELLS);
VOID_FUNCTION(VDP_DRAW_SCREEN);
VOID_FUNCTION(VDP_DRAW_SCANLINES);
VOID_FUNCTION(VDP_DRAW_PATTERN);
VOID_FUNCTION(VDP_DRAW_PLANE);
VOID_FUNCTION(VDP_DRAW_RECT);
VOID_FUNCTION(VDP_DRAW_SPRITES);

#endif
